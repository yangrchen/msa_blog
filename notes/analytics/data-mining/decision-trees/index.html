<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yang Chen">
<meta name="dcterms.date" content="2023-10-02">

<title>Yang MSA - Classification and Regression Trees (CART)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../favicon.ico" rel="icon">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Yang MSA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../notes/index.html"> 
<span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/yangrchen"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Classification and Regression Trees (CART)</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">analytics</div>
                <div class="quarto-category">data mining</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Yang Chen </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 2, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">October 6, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#classification-trees" id="toc-classification-trees" class="nav-link active" data-scroll-target="#classification-trees"><span class="header-section-number">1</span> Classification Trees</a></li>
  <li><a href="#building-the-tree-overview" id="toc-building-the-tree-overview" class="nav-link" data-scroll-target="#building-the-tree-overview"><span class="header-section-number">2</span> Building the Tree Overview</a></li>
  <li><a href="#selecting-the-best-split" id="toc-selecting-the-best-split" class="nav-link" data-scroll-target="#selecting-the-best-split"><span class="header-section-number">3</span> Selecting the Best Split</a>
  <ul class="collapse">
  <li><a href="#entropy" id="toc-entropy" class="nav-link" data-scroll-target="#entropy"><span class="header-section-number">3.1</span> Entropy</a></li>
  <li><a href="#ginis-impurity" id="toc-ginis-impurity" class="nav-link" data-scroll-target="#ginis-impurity"><span class="header-section-number">3.2</span> Gini’s Impurity</a></li>
  <li><a href="#gain" id="toc-gain" class="nav-link" data-scroll-target="#gain"><span class="header-section-number">3.3</span> Gain</a></li>
  </ul></li>
  <li><a href="#building-process" id="toc-building-process" class="nav-link" data-scroll-target="#building-process"><span class="header-section-number">4</span> Building Process</a></li>
  <li><a href="#evaluating-tree-models" id="toc-evaluating-tree-models" class="nav-link" data-scroll-target="#evaluating-tree-models"><span class="header-section-number">5</span> Evaluating Tree Models</a></li>
  <li><a href="#regression-trees" id="toc-regression-trees" class="nav-link" data-scroll-target="#regression-trees"><span class="header-section-number">6</span> Regression Trees</a>
  <ul class="collapse">
  <li><a href="#pruning-tree" id="toc-pruning-tree" class="nav-link" data-scroll-target="#pruning-tree"><span class="header-section-number">6.1</span> Pruning Tree</a></li>
  </ul></li>
  <li><a href="#advantages-and-disadvantages" id="toc-advantages-and-disadvantages" class="nav-link" data-scroll-target="#advantages-and-disadvantages"><span class="header-section-number">7</span> Advantages and Disadvantages</a></li>
  <li><a href="#conditional-trees" id="toc-conditional-trees" class="nav-link" data-scroll-target="#conditional-trees"><span class="header-section-number">8</span> Conditional Trees</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>A decision tree has a <strong>root node</strong> and a series of nodes splitting off from the node based on rules on the variables in the data. We typically use a binary tree as it shows empirically good results than <span class="math inline">\(n\)</span>-ary tree.</p>
<p>Leaf nodes are the final output of decision tree models.</p>
<div id="fig-decision-tree" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-decision-tree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/decision-tree.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-decision-tree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Decision Tree Visualized
</figcaption>
</figure>
</div>
<p>Notes on decision trees:</p>
<ul>
<li>Interpretable</li>
<li>List of decisions that predict the outcome that are easy to implement</li>
<li>Allow for nonlinear associations</li>
<li>Allow for interactions</li>
<li>Can handle missing values</li>
<li>Are greedy algorithms (picks the “best” split at each point and settles on that split without going back)</li>
</ul>
<section id="classification-trees" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Classification Trees</h1>
<p>Classification trees have an ordinal or categorical target. To determine the quality of a node, we use <strong>purity</strong>.</p>
<p>Purity of a node is looking at how “homogeneous” the node is with respect to the target variable. <a href="#fig-purity" class="quarto-xref">Figure&nbsp;2</a> shows an example of how purity is measured for the root node and one of the child nodes.</p>
<div id="fig-purity" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-purity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/decision-tree-purity.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-purity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Classification Tree Purity
</figcaption>
</figure>
</div>
</section>
<section id="building-the-tree-overview" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Building the Tree Overview</h1>
<!-- Need to put mermaid tables here -->
<p>A tree is built by recursively partioning the training data into successively <em>purer</em> subsets. Partiioning is done according to some condition which results in a binary split.</p>
<p>For categorical predictors, we need to put categories into two groups. An example for a predictor with A, B, and C levels is A vs.&nbsp;B and C or B vs.&nbsp;A and C.</p>
<p>For ordinal and quantitative variables, need to find the best value to split on. Data is “binned” into two groups and need to determine best way to bin based on the target.</p>
</section>
<section id="selecting-the-best-split" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Selecting the Best Split</h1>
<div id="fig-purity-scale" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-purity-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/purity-scale.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-purity-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Measures of Purity
</figcaption>
</figure>
</div>
<p>For a binary tree, a 50-50 split is the lowest purity we could have. The highest purity is 1.00 which means the node only contains a single level.</p>
<p>How do we choose the best split?</p>
<p>Let <span class="math inline">\(p(i|t)\)</span> represent the the fraction of records belonging to class <span class="math inline">\(i\)</span> at a given node <span class="math inline">\(t\)</span>. Let <span class="math inline">\(c\)</span> be the number of classes in a target variable.</p>
<p>Two common measures for <strong>impurity</strong> are <strong>entropy</strong> and <strong>Gini’s impurity</strong>.</p>
<section id="entropy" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="entropy"><span class="header-section-number">3.1</span> Entropy</h2>
<p><span class="math display">\[
-\sum_{i=1}^c p(i|t)\log_2p(i|t)
\]</span></p>
</section>
<section id="ginis-impurity" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="ginis-impurity"><span class="header-section-number">3.2</span> Gini’s Impurity</h2>
<p><span class="math display">\[
1 - \sum_{i=1}^{c} [p(i|t)]^2
\]</span></p>
</section>
<section id="gain" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="gain"><span class="header-section-number">3.3</span> Gain</h2>
<p>The impurity of nodes is involved in calculating the <strong>gain</strong> of a node. Gain is measuring how much impurity we have reduced due to the split. We want gain to be high as it represents a significant difference in impurity.</p>
<p><span class="math display">\[
\Delta = I(t) = (\frac{n_L}{n}I(t_L) + \frac{n_R}{n}I(t_R))
\]</span></p>
<ul>
<li><span class="math inline">\(\Delta\)</span> is the gain</li>
<li><span class="math inline">\(I(t)\)</span> is the impurity of a parent node</li>
<li><span class="math inline">\(I(t_L)\)</span> and <span class="math inline">\(I(t_R)\)</span> are impurity in the left and right children nodes, respectively</li>
</ul>
<p>Gain uses a weighted average between the impurity of the two children nodes.</p>
</section>
</section>
<section id="building-process" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Building Process</h1>
<ol type="1">
<li>Compute the gain for all possible splits and select the best one.</li>
<li>Repeat process recursively until some stopping condition is met
<ol type="1">
<li>No splits meet some minimum Gain</li>
<li>All leaves have some minimum number of observations</li>
<li>A stopping condition is a way of <em>prepruning</em> the tree</li>
</ol></li>
<li>Prune Tree</li>
</ol>
<p>Pruning a tree refers to removing leaves / nodes in a bottom-up fashion, cutting splits with lowest gain first, while optimizing performance on validation data.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>In R, the children nodes are numbered <span class="math inline">\(2n\)</span> (left) and <span class="math inline">\(2n + 1\)</span> (right). The root node starts at number 1.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">use_condaenv</span>(<span class="st">"msa"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7515</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/breast_cancer.Rdata"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>perm <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">699</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>BC_randomOrder <span class="ot">&lt;-</span> BCdata[perm, ]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> BC_randomOrder[<span class="dv">1</span><span class="sc">:</span><span class="fu">floor</span>(<span class="fl">0.75</span> <span class="sc">*</span> <span class="dv">699</span>), ]</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> BC_randomOrder[(<span class="fu">floor</span>(<span class="fl">0.75</span> <span class="sc">*</span> <span class="dv">699</span>) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">699</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>BC_tree <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Target <span class="sc">~</span> . <span class="sc">-</span> ID, <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, <span class="at">parms =</span> <span class="fu">list</span>(<span class="at">split =</span> <span class="st">"gini"</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>BC_tree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>n= 524 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

 1) root 524 183 0 (0.65076336 0.34923664)  
   2) Size&lt; 3.5 360  28 0 (0.92222222 0.07777778)  
     4) Normal&lt; 3.5 334   8 0 (0.97604790 0.02395210)  
       8) Bare&lt; 2.5 308   0 0 (1.00000000 0.00000000) *
       9) Bare&gt;=2.5 26   8 0 (0.69230769 0.30769231)  
        18) CT&lt; 3.5 16   0 0 (1.00000000 0.00000000) *
        19) CT&gt;=3.5 10   2 1 (0.20000000 0.80000000) *
     5) Normal&gt;=3.5 26   6 1 (0.23076923 0.76923077) *
   3) Size&gt;=3.5 164   9 1 (0.05487805 0.94512195) *</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> tree</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>bcdata <span class="op">=</span> r.BCdata</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> bcdata.iloc[:, <span class="dv">1</span>:<span class="dv">10</span>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> bcdata[<span class="st">"Target"</span>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    X, y, random_state<span class="op">=</span><span class="dv">49865</span>, test_size<span class="op">=</span><span class="fl">0.25</span>, shuffle<span class="op">=</span><span class="va">True</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>class_tree <span class="op">=</span> tree.DecisionTreeClassifier(criterion<span class="op">=</span><span class="st">"entropy"</span>, max_depth<span class="op">=</span><span class="dv">3</span>).fit(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    X_train, y_train</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
</section>
<section id="evaluating-tree-models" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Evaluating Tree Models</h1>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tscores <span class="ot">&lt;-</span> <span class="fu">predict</span>(BC_tree, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> <span class="fu">predict</span>(BC_tree, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Training misclassification rate</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(tscores <span class="sc">!=</span> train<span class="sc">$</span>Target) <span class="sc">/</span> <span class="fu">nrow</span>(train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03244275</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test misclassification rate</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(scores <span class="sc">!=</span> test<span class="sc">$</span>Target) <span class="sc">/</span> <span class="fu">nrow</span>(test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05714286</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(BC_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> class_tree.predict(X_test)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>conf <span class="op">=</span> confusion_matrix(y_test, y_pred)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(conf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[110  10]
 [  4  51]]</code></pre>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tree.plot_tree(class_tree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="regression-trees" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Regression Trees</h1>
<p>Same idea as classification trees but now our target is continuous. We no longer use Information / Gini since it no longers makes sense in this case. Instead, we are now trying to reduce the average sum of squares in each leaf.</p>
<p>In each node, the average of the observations will be calculated which is the predicted value for that node.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(bodyfat, <span class="at">package =</span> <span class="st">"TH.data"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13172</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(<span class="at">n =</span> <span class="fu">nrow</span>(bodyfat), <span class="at">size =</span> <span class="fu">floor</span>(<span class="fl">0.75</span> <span class="sc">*</span> <span class="fu">nrow</span>(bodyfat)), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> bodyfat[sample, ]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> bodyfat[<span class="sc">-</span>sample, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>body_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(DEXfat <span class="sc">~</span> age <span class="sc">+</span> waistcirc <span class="sc">+</span> hipcirc <span class="sc">+</span> elbowbreadth <span class="sc">+</span> kneebreadth, <span class="at">data =</span> train, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">10</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(body_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + 
    kneebreadth, data = train, control = rpart.control(minsplit = 10))
  n= 53 

          CP nsplit  rel error    xerror       xstd
1 0.67492210      0 1.00000000 1.0387549 0.19298200
2 0.12397892      1 0.32507790 0.3674702 0.09713363
3 0.06337174      2 0.20109898 0.3207674 0.07055438
4 0.04539485      3 0.13772723 0.3298414 0.07030078
5 0.01311181      4 0.09233238 0.2635804 0.07215928
6 0.01000000      5 0.07922057 0.2502471 0.06967234

Variable importance
   waistcirc      hipcirc  kneebreadth elbowbreadth          age 
          30           25           25           11            9 

Node number 1: 53 observations,    complexity param=0.6749221
  mean=31.98226, MSE=126.5508 
  left son=2 (25 obs) right son=3 (28 obs)
  Primary splits:
      waistcirc    &lt; 86.5   to the left,  improve=0.6749221, (0 missing)
      hipcirc      &lt; 109.25 to the left,  improve=0.6400649, (0 missing)
      kneebreadth  &lt; 9.35   to the left,  improve=0.4913650, (0 missing)
      age          &lt; 37     to the left,  improve=0.1897384, (0 missing)
      elbowbreadth &lt; 6.55   to the left,  improve=0.1514361, (0 missing)
  Surrogate splits:
      hipcirc      &lt; 107.85 to the left,  agree=0.887, adj=0.76, (0 split)
      kneebreadth  &lt; 9.35   to the left,  agree=0.849, adj=0.68, (0 split)
      elbowbreadth &lt; 6.55   to the left,  agree=0.679, adj=0.32, (0 split)
      age          &lt; 37     to the left,  agree=0.660, adj=0.28, (0 split)

Node number 2: 25 observations,    complexity param=0.04539485
  mean=22.2016, MSE=24.60555 
  left son=4 (11 obs) right son=5 (14 obs)
  Primary splits:
      hipcirc      &lt; 96.5   to the left,  improve=0.49496490, (0 missing)
      waistcirc    &lt; 75.15  to the left,  improve=0.43069200, (0 missing)
      age          &lt; 31.5   to the left,  improve=0.33752490, (0 missing)
      kneebreadth  &lt; 8.55   to the left,  improve=0.24410760, (0 missing)
      elbowbreadth &lt; 6.65   to the left,  improve=0.08933998, (0 missing)
  Surrogate splits:
      waistcirc    &lt; 72     to the left,  agree=0.76, adj=0.455, (0 split)
      kneebreadth  &lt; 8.25   to the left,  agree=0.76, adj=0.455, (0 split)
      age          &lt; 31.5   to the left,  agree=0.72, adj=0.364, (0 split)
      elbowbreadth &lt; 6.45   to the left,  agree=0.64, adj=0.182, (0 split)

Node number 3: 28 observations,    complexity param=0.1239789
  mean=40.715, MSE=55.90078 
  left son=6 (25 obs) right son=7 (3 obs)
  Primary splits:
      kneebreadth  &lt; 11.15  to the left,  improve=0.53126700, (0 missing)
      hipcirc      &lt; 109.9  to the left,  improve=0.49501800, (0 missing)
      waistcirc    &lt; 106    to the left,  improve=0.48547170, (0 missing)
      elbowbreadth &lt; 6.35   to the left,  improve=0.18322950, (0 missing)
      age          &lt; 64     to the left,  improve=0.06033762, (0 missing)

Node number 4: 11 observations,    complexity param=0.01311181
  mean=18.26455, MSE=16.37561 
  left son=8 (7 obs) right son=9 (4 obs)
  Primary splits:
      age          &lt; 56.5   to the left,  improve=0.48821750, (0 missing)
      waistcirc    &lt; 77.5   to the left,  improve=0.37437570, (0 missing)
      hipcirc      &lt; 94.1   to the left,  improve=0.26063300, (0 missing)
      kneebreadth  &lt; 8.55   to the left,  improve=0.02392090, (0 missing)
      elbowbreadth &lt; 6.15   to the left,  improve=0.02295546, (0 missing)
  Surrogate splits:
      waistcirc    &lt; 77.5   to the left,  agree=0.818, adj=0.50, (0 split)
      elbowbreadth &lt; 6.55   to the left,  agree=0.818, adj=0.50, (0 split)
      hipcirc      &lt; 91.5   to the right, agree=0.727, adj=0.25, (0 split)

Node number 5: 14 observations
  mean=25.295, MSE=9.323925 

Node number 6: 25 observations,    complexity param=0.06337174
  mean=38.8272, MSE=23.49564 
  left son=12 (11 obs) right son=13 (14 obs)
  Primary splits:
      hipcirc      &lt; 109.9  to the left,  improve=0.72361790, (0 missing)
      waistcirc    &lt; 98.75  to the left,  improve=0.46229770, (0 missing)
      elbowbreadth &lt; 6.35   to the left,  improve=0.24168590, (0 missing)
      kneebreadth  &lt; 9.9    to the left,  improve=0.22697980, (0 missing)
      age          &lt; 60.5   to the left,  improve=0.03275597, (0 missing)
  Surrogate splits:
      waistcirc    &lt; 98.75  to the left,  agree=0.84, adj=0.636, (0 split)
      elbowbreadth &lt; 6.45   to the left,  agree=0.76, adj=0.455, (0 split)
      kneebreadth  &lt; 8.75   to the left,  agree=0.68, adj=0.273, (0 split)
      age          &lt; 49.5   to the right, agree=0.60, adj=0.091, (0 split)

Node number 7: 3 observations
  mean=56.44667, MSE=48.76009 

Node number 8: 7 observations
  mean=16.12714, MSE=8.875049 

Node number 9: 4 observations
  mean=22.005, MSE=7.515725 

Node number 12: 11 observations
  mean=34.17545, MSE=7.173207 

Node number 13: 14 observations
  mean=42.48214, MSE=5.959931 </code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(body_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Regression tree:
rpart(formula = DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + 
    kneebreadth, data = train, control = rpart.control(minsplit = 10))

Variables actually used in tree construction:
[1] age         hipcirc     kneebreadth waistcirc  

Root node error: 6707.2/53 = 126.55

n= 53 

        CP nsplit rel error  xerror     xstd
1 0.674922      0  1.000000 1.03875 0.192982
2 0.123979      1  0.325078 0.36747 0.097134
3 0.063372      2  0.201099 0.32077 0.070554
4 0.045395      3  0.137727 0.32984 0.070301
5 0.013112      4  0.092332 0.26358 0.072159
6 0.010000      5  0.079221 0.25025 0.069672</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> r.train</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> r.test</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> train[[<span class="st">"age"</span>, <span class="st">"waistcirc"</span>, <span class="st">"hipcirc"</span>, <span class="st">"elbowbreadth"</span>, <span class="st">"kneebreadth"</span>]]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> test[[<span class="st">"age"</span>, <span class="st">"waistcirc"</span>, <span class="st">"hipcirc"</span>, <span class="st">"elbowbreadth"</span>, <span class="st">"kneebreadth"</span>]]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> train[<span class="st">"DEXfat"</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>y_test <span class="op">=</span> test[<span class="st">"DEXfat"</span>]</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>regressor <span class="op">=</span> tree.DecisionTreeRegressor(random_state<span class="op">=</span><span class="dv">12356</span>, max_depth<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>reg_tree <span class="op">=</span> regressor.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> regressor.feature_importances_</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, v <span class="kw">in</span> <span class="bu">enumerate</span>(importance):</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Feature </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">, Score: </span><span class="sc">{</span>v<span class="sc">:.5f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Feature 0, Score: 0.01353
Feature 1, Score: 0.70797
Feature 2, Score: 0.12906
Feature 3, Score: 0.00809
Feature 4, Score: 0.14136</code></pre>
</div>
</div>
</div>
</div>
</div>
<section id="pruning-tree" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="pruning-tree"><span class="header-section-number">6.1</span> Pruning Tree</h2>
<p>To prune the tree, there are different criteria that we can use. Two of the common methods:</p>
<ul>
<li>Go to the minimum value of “xerror” (cross-validation error)</li>
<li>Use the 1-SE rule
<ul>
<li>Use the standard error of the crossvalidation error to find what is within 1 standard error of the lowest value and prune to that value</li>
</ul></li>
</ul>
<p>In R, we select the CP of the node we want to prune to:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>body_model2 <span class="ot">&lt;-</span> <span class="fu">prune</span>(body_model, <span class="at">cp =</span> <span class="fl">0.013112</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(body_model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Regression tree:
rpart(formula = DEXfat ~ age + waistcirc + hipcirc + elbowbreadth + 
    kneebreadth, data = train, control = rpart.control(minsplit = 10))

Variables actually used in tree construction:
[1] hipcirc     kneebreadth waistcirc  

Root node error: 6707.2/53 = 126.55

n= 53 

        CP nsplit rel error  xerror     xstd
1 0.674922      0  1.000000 1.03875 0.192982
2 0.123979      1  0.325078 0.36747 0.097134
3 0.063372      2  0.201099 0.32077 0.070554
4 0.045395      3  0.137727 0.32984 0.070301
5 0.013112      4  0.092332 0.26358 0.072159</code></pre>
</div>
</div>
</section>
</section>
<section id="advantages-and-disadvantages" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Advantages and Disadvantages</h1>
<p>Advantages:</p>
<ul>
<li>Explainability</li>
<li>Can handle missing values</li>
<li>Can be used for variable selection</li>
<li>Great for ensembles</li>
<li>No assumptions to verify</li>
<li>Generally immune to scale of input variables / standardization</li>
<li>Generally immune to the effect of outliers or high leverage observations</li>
<li>Can handle correlated inputs</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>Simplistic regression / decision surface</li>
<li>All variables are forced to interact</li>
<li>Greedy algorithm
<ul>
<li>Cannot return globally optimal tree</li>
</ul></li>
<li>Can be unstable (sensitive to small changes in input) both when training and making predictions</li>
</ul>
</section>
<section id="conditional-trees" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Conditional Trees</h1>
<p>Conditional trees select the best variable based on which variable is <strong>most associated with the response</strong> with p-value adjustment. Once selected, the optimal split is chosen for that variable.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(partykit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: libcoin</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: mvtnorm</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7515</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>perm <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">699</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>BC_randomOrder <span class="ot">&lt;-</span> BCdata[perm, ]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> BC_randomOrder[<span class="dv">1</span><span class="sc">:</span><span class="fu">floor</span>(<span class="fl">0.75</span> <span class="sc">*</span> <span class="dv">699</span>), ]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">ctree</span>(Target <span class="sc">~</span> . <span class="sc">-</span> ID, <span class="at">data =</span> train)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Conditional trees can be used to find bins by creating a model with the variable you want to bin:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">ctree</span>(Target <span class="sc">~</span> Size, <span class="at">data =</span> train)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this case the bins are:</p>
<ul>
<li>Size <span class="math inline">\(\leq\)</span> 1</li>
<li>1 &lt; Size <span class="math inline">\(\leq\)</span> 2</li>
<li>2 &lt; Size <span class="math inline">\(\leq\)</span> 3</li>
<li>And so on!</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>