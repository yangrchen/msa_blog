<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yang Chen">
<meta name="dcterms.date" content="2023-06-29">

<title>Yang MSA - Introduction to ANOVA and Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../favicon.ico" rel="icon">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Yang MSA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../notes/index.html" rel="" target="">
 <span class="menu-text">Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog/index.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/yangrchen" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Introduction to ANOVA and Regression</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">analytics</div>
                <div class="quarto-category">ANOVA</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Yang Chen </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 29, 2023</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">July 22, 2023</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#linear-models" id="toc-linear-models" class="nav-link active" data-scroll-target="#linear-models"><span class="header-section-number">1</span> Linear Models</a>
  <ul class="collapse">
  <li><a href="#honest-model-assessment" id="toc-honest-model-assessment" class="nav-link" data-scroll-target="#honest-model-assessment"><span class="header-section-number">1.1</span> Honest Model Assessment</a>
  <ul class="collapse">
  <li><a href="#the-overfitting-problem" id="toc-the-overfitting-problem" class="nav-link" data-scroll-target="#the-overfitting-problem"><span class="header-section-number">1.1.1</span> The Overfitting Problem</a></li>
  </ul></li>
  <li><a href="#train-test-split-in-r" id="toc-train-test-split-in-r" class="nav-link" data-scroll-target="#train-test-split-in-r"><span class="header-section-number">1.2</span> Train-Test Split in R</a></li>
  </ul></li>
  <li><a href="#bivariate-exploratory-data-analysis" id="toc-bivariate-exploratory-data-analysis" class="nav-link" data-scroll-target="#bivariate-exploratory-data-analysis"><span class="header-section-number">2</span> Bivariate Exploratory Data Analysis</a></li>
  <li><a href="#one-way-anova" id="toc-one-way-anova" class="nav-link" data-scroll-target="#one-way-anova"><span class="header-section-number">3</span> One-Way ANOVA</a>
  <ul class="collapse">
  <li><a href="#assumptions-for-anova" id="toc-assumptions-for-anova" class="nav-link" data-scroll-target="#assumptions-for-anova"><span class="header-section-number">3.1</span> Assumptions for ANOVA</a>
  <ul class="collapse">
  <li><a href="#assessing-anova-assumptions" id="toc-assessing-anova-assumptions" class="nav-link" data-scroll-target="#assessing-anova-assumptions"><span class="header-section-number">3.1.1</span> Assessing ANOVA Assumptions</a></li>
  </ul></li>
  <li><a href="#anova-hypothesis-test-in-r" id="toc-anova-hypothesis-test-in-r" class="nav-link" data-scroll-target="#anova-hypothesis-test-in-r"><span class="header-section-number">3.2</span> ANOVA Hypothesis Test in R</a></li>
  </ul></li>
  <li><a href="#welchs-anova" id="toc-welchs-anova" class="nav-link" data-scroll-target="#welchs-anova"><span class="header-section-number">4</span> Welch’s ANOVA</a></li>
  <li><a href="#kruskal-wallis" id="toc-kruskal-wallis" class="nav-link" data-scroll-target="#kruskal-wallis"><span class="header-section-number">5</span> Kruskal-Wallis</a>
  <ul class="collapse">
  <li><a href="#r-code" id="toc-r-code" class="nav-link" data-scroll-target="#r-code"><span class="header-section-number">5.1</span> R Code</a></li>
  </ul></li>
  <li><a href="#anova-analysis-plan-summmary" id="toc-anova-analysis-plan-summmary" class="nav-link" data-scroll-target="#anova-analysis-plan-summmary"><span class="header-section-number">6</span> ANOVA Analysis Plan Summmary</a></li>
  <li><a href="#anova-post-hoc-tests" id="toc-anova-post-hoc-tests" class="nav-link" data-scroll-target="#anova-post-hoc-tests"><span class="header-section-number">7</span> ANOVA Post-Hoc Tests</a>
  <ul class="collapse">
  <li><a href="#tukeys-honest-significant-difference" id="toc-tukeys-honest-significant-difference" class="nav-link" data-scroll-target="#tukeys-honest-significant-difference"><span class="header-section-number">7.1</span> Tukey’s Honest Significant Difference</a></li>
  <li><a href="#dunnetts-test-for-control-comparison" id="toc-dunnetts-test-for-control-comparison" class="nav-link" data-scroll-target="#dunnetts-test-for-control-comparison"><span class="header-section-number">7.2</span> Dunnett’s Test for Control Comparison</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="linear-models" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Linear Models</h1>
<p>The population model for our linear model is written as:</p>
<p><span class="math display">\[
y = \beta_0 + \beta_1x_1 + \cdots + \beta_kx_k + \varepsilon
\]</span></p>
<ul>
<li><span class="math inline">\(\varepsilon\)</span> is the random error</li>
<li>All the modeled signal is the rest of the equation which is called the <strong>deterministic component</strong></li>
<li><span class="math inline">\(x_1, \cdots, x_k\)</span> are the explanatory variables</li>
<li><span class="math inline">\(y\)</span> is the response variable</li>
</ul>
<p>Typically linear models are used in an explanatory model fashion–we are trying to answer how our explanatory variables are related to our response. We are not predicting the response. Models tend to be simpler and we focus on p-values and confidence intervals for interpretation.</p>
<section id="honest-model-assessment" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="honest-model-assessment"><span class="header-section-number">1.1</span> Honest Model Assessment</h2>
<p>Before you look for any relationships, you should split into <strong>training</strong>, <strong>validation</strong> and <strong>test</strong> samples.</p>
<p>Different rules of thumb for splits:</p>
<ul>
<li>Lots of data? 50-40-10 split</li>
<li>Not so much data? 70-20-10 split</li>
<li>Not enough data? Use Cross-Validation</li>
</ul>
<section id="the-overfitting-problem" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="the-overfitting-problem"><span class="header-section-number">1.1.1</span> The Overfitting Problem</h3>
<p>Models will capture nuances of the data on which they’re built (training data)</p>
<p>When these “patterns” do not hold up in validation or test, the model performance suffers. We call this <strong>overfitting</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/overfitting.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Overfitting Example</figcaption>
</figure>
</div>
</section>
</section>
<section id="train-test-split-in-r" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="train-test-split-in-r"><span class="header-section-number">1.2</span> Train-Test Split in R</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AmesHousing)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ames <span class="ot">&lt;-</span> <span class="fu">make_ordinal_ames</span>()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ames <span class="ot">&lt;-</span> ames <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>())</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> ames <span class="sc">|&gt;</span> <span class="fu">sample_frac</span>(<span class="fl">0.7</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(ames, train, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2051   82</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 879  82</code></pre>
</div>
</div>
</section>
</section>
<section id="bivariate-exploratory-data-analysis" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Bivariate Exploratory Data Analysis</h1>
<p>An <strong>association</strong> is the expected value of one variable changes at different levels of the other variable.</p>
<p>A <strong>linear association</strong> between two continuous can be inferred when the general shape of a scatter plot is similar to a straight line.</p>
<p>One way to see associations with a continuous variable across our categorical variable is by using side-by-side boxplots or overlaid histograms:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(train, <span class="fu">aes</span>(<span class="at">y =</span> Sale_Price <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">x =</span> Exter_Qual, <span class="at">fill =</span> Exter_Qual)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Sales Price (Thousands $)"</span>, <span class="at">x =</span> <span class="st">"Exterior Quality Category"</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">fill =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/boxplots-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ames, <span class="fu">aes</span>(<span class="at">x =</span> Sale_Price <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">fill =</span> Exter_Qual)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sales Price (Thousands $)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/overlaid-density-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>In the density plot, variance is different between groups and the Excellent quality seems to have a higher overall mean</li>
</ul>
</section>
<section id="one-way-anova" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> One-Way ANOVA</h1>
<p>One-Way ANOVA is a test of relationship between <strong>categorical variable</strong> and <strong>quantitative response</strong>.</p>
<p>One-Way refers to only one factor (e.g.&nbsp;a group of quality ratings).</p>
<p>We are comparing <span class="math inline">\(k\)</span> levels of our predictor variable and seeing if there are any statistically significant difference in their mean response.</p>
<div class="text-center">
<p><span class="math inline">\(H_0: F_1 = F_2 = F_3 = F_4\)</span></p>
<p><span class="math inline">\(H_a:\)</span> Atleast one mean is different</p>
</div>
<p>In the ANOVA model, instead of using <em>one-hot encoding</em> for our variables, we use reference coding where we drop one of the levels. The level dropped will be the <strong>reference level</strong>.</p>
<table class="table">
<thead>
<tr class="header">
<th>Level</th>
<th><span class="math inline">\(x_a\)</span></th>
<th><span class="math inline">\(x_b\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>B</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td>C</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p><span class="math display">\[
y = \beta_0 + \beta_Ax_A + \beta_Bx_B + \varepsilon
\]</span></p>
<ul>
<li><span class="math inline">\(\beta_A\)</span> is the difference between mean response in level A vs.&nbsp;level C</li>
<li>There are <strong>three unique values</strong> possible for the predicted value–one for each level</li>
</ul>
<section id="assumptions-for-anova" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="assumptions-for-anova"><span class="header-section-number">3.1</span> Assumptions for ANOVA</h2>
<ul>
<li>Observations are independent</li>
<li>Each group is normally distributed
<ul>
<li>Or the <em>residuals</em> of the ANOVA model are normally distributed</li>
</ul></li>
<li>All groups have equal variances (homoskedasticity)
<ul>
<li>If true, use “pooled” variance</li>
<li>If false, use Welch’s ANOVA</li>
</ul></li>
</ul>
<section id="assessing-anova-assumptions" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="assessing-anova-assumptions"><span class="header-section-number">3.1.1</span> Assessing ANOVA Assumptions</h3>
<ul>
<li>Good data collection designs help the independence assumption</li>
<li>Informal plots (QQ-Plots) or formal tests can verify the normally distributed assumption</li>
<li>Formal test of equal variances or viewing residual plot to assess homoskedasticity</li>
</ul>
</section>
</section>
<section id="anova-hypothesis-test-in-r" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="anova-hypothesis-test-in-r"><span class="header-section-number">3.2</span> ANOVA Hypothesis Test in R</h2>
<p><span class="math inline">\(H_0\)</span> is the means of each level of <code>Exter-Qual</code> are equal.</p>
<p><span class="math inline">\(H_a\)</span> is at least one mean is different.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>ames_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> Exter_Qual, <span class="at">data =</span> train)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(ames_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Sale_Price
             Df     Sum Sq    Mean Sq F value    Pr(&gt;F)    
Exter_Qual    3 6.6913e+12 2.2304e+12  701.83 &lt; 2.2e-16 ***
Residuals  2047 6.5054e+12 3.1780e+09                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ul>
<li>There appears to be a significant difference in mean sales price between the different levels of exterior quality.</li>
</ul>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>train<span class="sc">$</span>pred_anova <span class="ot">&lt;-</span> <span class="fu">predict</span>(ames_lm, <span class="at">data =</span> train)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>train<span class="sc">$</span>resid_anova <span class="ot">&lt;-</span> <span class="fu">resid</span>(ames_lm, <span class="at">data =</span> train)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>model_output <span class="ot">&lt;-</span> train <span class="sc">|&gt;</span> <span class="fu">select</span>(Sale_Price, pred_anova, resid_anova)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>model_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,051 × 3
   Sale_Price pred_anova resid_anova
        &lt;int&gt;      &lt;dbl&gt;       &lt;dbl&gt;
 1     232600    228910.       3690.
 2     166000    228910.     -62910.
 3     170000    142107.      27893.
 4     252000    228910.      23090.
 5     134000    142107.      -8107.
 6     164700    228910.     -64210.
 7     193500    142107.      51393.
 8     118500    142107.     -23607.
 9      94000    142107.     -48107.
10     111250    142107.     -30857.
# ℹ 2,041 more rows</code></pre>
</div>
</div>
<p>And then to test assumptions:</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ames_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/testing-assumptions-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To formally test our variance, we have <strong>Levene’s Test</strong> which <strong>requires normality of underlying data</strong> and <strong>Fligner’s Test</strong> which does <strong>not require normality</strong>.</p>
<div class="text-center">
<p><span class="math inline">\(H_0:\)</span> The group variances are equal</p>
<p><span class="math inline">\(H_a:\)</span> The group variances are NOT equal</p>
</div>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">leveneTest</span>(Sale_Price <span class="sc">~</span> Exter_Qual, <span class="at">data =</span> train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
        Df F value    Pr(&gt;F)    
group    3  76.879 &lt; 2.2e-16 ***
      2047                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fligner.test</span>(Sale_Price <span class="sc">~</span> Exter_Qual, <span class="at">data =</span> train)<span class="sc">$</span>p.value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.873388e-44</code></pre>
</div>
</div>
</section>
</section>
<section id="welchs-anova" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Welch’s ANOVA</h1>
<p>We use Welch’s ANOVA when the equal variances assumption fails. Similar to the two-sample t-test with unequal variances.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">oneway.test</span>(Sale_Price <span class="sc">~</span> Exter_Qual, <span class="at">data =</span> train, <span class="at">var.equal =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    One-way analysis of means (not assuming equal variances)

data:  Sale_Price and Exter_Qual
F = 431.82, num df = 3.00, denom df = 102.11, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="kruskal-wallis" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Kruskal-Wallis</h1>
<p>Kruskal-Wallis is a nonparametric test for more than two groups:</p>
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Conditions</th>
<th style="text-align: left;">Interpretation of Significant Kruskal-Wallis Test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Group distributions are identical in shape, variance, and symmetric</td>
<td style="text-align: left;">Difference in means</td>
</tr>
<tr class="even">
<td style="text-align: left;">Group distributions are identical in shape, variance, but not symmetric</td>
<td style="text-align: left;">Difference in medians</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Else</td>
<td style="text-align: left;">Difference in location (distributional dominance)</td>
</tr>
</tbody>
</table>
<section id="r-code" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="r-code"><span class="header-section-number">5.1</span> R Code</h2>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(Sale_Price <span class="sc">~</span> Exter_Qual, <span class="at">data =</span> train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  Sale_Price by Exter_Qual
Kruskal-Wallis chi-squared = 975.98, df = 3, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
</section>
<section id="anova-analysis-plan-summmary" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> ANOVA Analysis Plan Summmary</h1>
<div class="text-center">
<p><span class="math inline">\(H_0:\)</span> All means are equal.</p>
<p><span class="math inline">\(H_a:\)</span> At least one mean is different</p>
</div>
<ol type="1">
<li>Produce descriptive statistics</li>
<li>Verify assumptions
<ol type="1">
<li>Independence</li>
<li>Normality</li>
<li>Equal variance for all groups</li>
</ol></li>
<li>Examine the p-value for overall F-test in the ANOVA table. If p-value <span class="math inline">\(&lt; \alpha\)</span>, reject <span class="math inline">\(H_0\)</span></li>
</ol>
</section>
<section id="anova-post-hoc-tests" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> ANOVA Post-Hoc Tests</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/experiment-error-rate.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Experimentwise Error Rate</figcaption>
</figure>
</div>
<p>While the ANOVA F-Test tells us if at least one group mean is different, we need to understand which groups are different.</p>
<p>We will compare the groups pairwise to determine if they are different.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart LR
    A[Control Experimentwise Error Rate] --&gt; B[All Pairwise Comparisons]
    A --&gt; C[Comparisons to a Control]
    B --&gt; D[Tukey]
    C --&gt; E[Dunnett]
</pre>
</div>
</div>
</div>
</div>
<section id="tukeys-honest-significant-difference" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="tukeys-honest-significant-difference"><span class="header-section-number">7.1</span> Tukey’s Honest Significant Difference</h2>
<p>Appropriate for making <em>all</em> pairwise comparisons between groups.</p>
<p>Experimentwise error rate is equal to <span class="math inline">\(\alpha\)</span> when <em>all</em> pairwise comparisons are made and less than <span class="math inline">\(\alpha\)</span> otherwise.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ames_aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(Sale_Price <span class="sc">~</span> Exter_Qual, <span class="at">data =</span> train)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>tukey.ames <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(ames_aov)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tukey.ames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = Sale_Price ~ Exter_Qual, data = train)

$Exter_Qual
                       diff       lwr       upr p adj
Typical-Fair       57887.91  30194.31  85581.52 5e-07
Good-Fair         144690.25 116739.87 172640.63 0e+00
Excellent-Fair    291684.79 259752.41 323617.16 0e+00
Good-Typical       86802.34  79910.03  93694.64 0e+00
Excellent-Typical 233796.87 216886.62 250707.12 0e+00
Excellent-Good    146994.54 129666.98 164322.10 0e+00</code></pre>
</div>
</div>
<ul>
<li>Conclusion is that all pairs are significantly different</li>
</ul>
</section>
<section id="dunnetts-test-for-control-comparison" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="dunnetts-test-for-control-comparison"><span class="header-section-number">7.2</span> Dunnett’s Test for Control Comparison</h2>
<p>If you’re not making all pairwise comparisons, Tukey’s is overly conservative.</p>
<div class="cell">
<details open="">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">DunnettTest</span>(<span class="at">x =</span> train<span class="sc">$</span>Sale_Price, <span class="at">g =</span> train<span class="sc">$</span>Exter_Qual, <span class="at">control =</span> <span class="st">"Typical"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
  Dunnett's test for comparing several treatments with a control :  
    95% family-wise confidence level

$Typical
                       diff    lwr.ci    upr.ci    pval    
Fair-Typical      -57887.91 -83628.55 -32147.28 2.6e-07 ***
Good-Typical       86802.34  80396.08  93208.59 &lt; 2e-16 ***
Excellent-Typical 233796.87 218079.15 249514.60 &lt; 2e-16 ***

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>