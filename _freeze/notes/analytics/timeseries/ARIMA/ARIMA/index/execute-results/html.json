{
  "hash": "3267004f6d165016ddfd7072ce09803a",
  "result": {
    "markdown": "---\ntitle: ARIMA Models\ndate: 09/13/2023\ndraft: true\n---\n\n\n# Setup {.unnumbered}\n\n:::{.panel-tabset group = \"language\"}\n# R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tseries)\nlibrary(forecast)\nlibrary(imputeTS)\n\nebay <- read.csv(\"https://raw.githubusercontent.com/sjsimmo2/TimeSeries/master/ebay9899.csv\")\nhurricane <- read.csv(\"https://raw.githubusercontent.com/sjsimmo2/TimeSeries/master/hurrican.csv\")\n```\n:::\n\n\n# Python\n\n\n::: {.cell}\n\n```{.python .cell-code}\nebay = r.ebay\nhurricane = r.hurricane\n```\n:::\n\n\n:::\n\n# ARIMA Model\n\nRemember that before you start using any ARMA or ARIMA models you need to have stationary data.\n\nThere is nothing to limit both AR and MA processes to be in the model simultaneously. These mixed models are typically used to help reduce the number of parameters needed for good estimation--parsimonious model.\n\nThe most basic model with only one lag of each piece with no differencing is ARMA(1, 1) model.\n\n$$\nY_t = \\omega + \\phi Y_{t-1} + e_t - \\theta e_{t-1}\n$$\n\nARMA(p, q) denotes mixture models where $p$ is the number of autoregressive terms and $q$ is the number of moving average terms.\n\nARIMA(p, d, q) represents $p$ autoregressive terms, $d$ number of differences, and $q$ number of moving average terms.\n\n# Correlation Graphs\n\nCharacteristics from separate pieces in the model are in the correlation functions. All of the functions tail off exponentially as the lags increase.\n\n# Trending Data\n\nIf there is a trend, the current series is **NOT** stationary. Trending series are not stationary because they do no converge to a mean in the long run.\n\nConsider one of two things:\n\n-   Series is stationary about a regression line.\n-   Series is a Random Walk with drift.\n\n## Regression Line Trend\n\n![Trend About a Regression Line](images/trend-regression-line.png)\n\nOnce we fit the trend line then our **residuals** are stationary.\n\nA **deterministic trend** is a linear trend like we have done in regression:\n\n$$\nY_t = \\beta_0 + \\beta_1 t + \\epsilon_t\n$$\n\n-   $t$ is time\n-   Can also fit quadratic, exponential, or any other form of time\n\n## Random Walk with Drift\n\n$$\nY_t = \\omega + Y_{t-1} + e_t\n$$\n\n-   $\\omega$ controls the \"drift\" or trend. If positive, \"drift\" upward; if negative, \"drift\" downward.\n\nRandom Walk with drift is **NOT** stationary if you remove the trend line. We need to take differences.\n\n## Dickey-Fuller Test for Trend\n\n:::{.text-center}\n$H_0: \\phi = 1$. Random walk with drift\n\n$H_a: \\left| \\phi \\right| < 1$. Deterministic trend, not stochastic trend\n:::\n\nStochastic trend refers to a random walk. Even if we reject the null hypothesis we still have to take care of the trend in some way.\n\n# Ebay Example\n\nEbay stock data using daily high information. September 1998 - December 1999.\n\nNote the dataset has missing values and we'll see how to see these visually.\n\n:::{.panel-tabset group = \"language\"}\n# R\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndaily_high <- ts(ebay$DailyHigh)\n# ADF test is not appropriate when we have missing values\n\nggplot_na_distribution(daily_high) + labs(y = \"Stock prices for Ebay\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n:::\n\n## Different Ways to Interpolate\n\n-   Fit a function between points\n-   Last observation carried forward\n-   Weighted moving average\n-   Summary statistics (e.g. mean or median of the series, but not always recommended)\n-   Random sample\n-   And so on!\n\n:::{.panel-tabset group = \"language\"}\n# R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(aTSA)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'aTSA'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:forecast':\n\n    forecast\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:tseries':\n\n    adf.test, kpss.test, pp.test\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:graphics':\n\n    identify\n```\n:::\n\n```{.r .cell-code}\ndaily_high <- daily_high %>%\n    na_interpolation(option = \"spline\")\n\nautoplot(daily_high) + labs(title = \"Daily High Stock Quotes\", x = \"Time\", y = \"Quotes\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Now we can perform ADF test\nadf.test(daily_high)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAugmented Dickey-Fuller Test \nalternative: stationary \n \nType 1: no drift no trend \n     lag   ADF p.value\n[1,]   0 0.414   0.763\n[2,]   1 0.148   0.687\n[3,]   2 0.266   0.720\n[4,]   3 0.330   0.739\n[5,]   4 0.385   0.755\n[6,]   5 0.434   0.769\nType 2: with drift no trend \n     lag   ADF p.value\n[1,]   0 -1.80   0.405\n[2,]   1 -2.01   0.324\n[3,]   2 -1.91   0.364\n[4,]   3 -1.90   0.367\n[5,]   4 -1.90   0.368\n[6,]   5 -1.92   0.361\nType 3: with drift and trend \n     lag   ADF p.value\n[1,]   0 -1.76   0.679\n[2,]   1 -2.13   0.520\n[3,]   2 -1.96   0.595\n[4,]   3 -1.89   0.622\n[5,]   4 -1.84   0.642\n[6,]   5 -1.82   0.653\n---- \nNote: in fact, p.value = 0.01 means p.value <= 0.01 \n```\n:::\n:::\n\n:::\n\n## Finding Mixed Models (p, q)\n\nExplore correlation plots (ACF, PACF) to see what patterns there are.\n\nWhat to explore correlations on:\n\n-   If series is stationary, just use series `ggAcf(y.ts)`\n-   If series is a random walk we need to take differences: `diff.y <- diff(y.ts)`\n    -   After taking difference, run ADF test to see if stationary. If not stationary, keep taking additional differences\n-   If series is a random walk with drift, use difference: `diff.y <- diff(y.ts)`\n-   If series is stationary about a line, use residuals: `resid.y <- lm(y ~ time)$resid`\n\n# Model Selection\n\n## Automatic Searches\n\n1.  Plotting Patterns - ACF, PACF\n2.  Automatic Selection Techniques (R and Python)\n    1.  `auto.arima` function\n\n### Recommendations\n\nIf there is a trend, test to see if it is a deterministic trend or random walk with drift.\n\nIf series has a deterministic trend, fit regression and then use automatic search on **residuals**. Otherwise, send series through automatic procedure (it will fit a difference if there is a trend).\n\nIf there is no trend, you can send series through automatic search.\n\n:::{.panel-tabset group=\"language\"}\n# R\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmax_velocity <- hurricane$MeanVMax\nggplot_na_distribution(max_velocity) +\n    labs(y = \"Mean Max Velocity\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nWe don't believe there is seasonality in our data so we can be comfortable omitting the missing values. As a rule of thumb, if there is a pattern then we should avoid removing data.\n\nWe don't seem to have trend so now we ask: is there stationarity?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmax_velocity <- na.omit(max_velocity)\nhurricane_ts <- ts(max_velocity)\naTSA::adf.test(hurricane_ts)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAugmented Dickey-Fuller Test \nalternative: stationary \n \nType 1: no drift no trend \n     lag     ADF p.value\n[1,]   0 -0.8242   0.384\n[2,]   1 -0.4391   0.517\n[3,]   2 -0.2585   0.569\n[4,]   3 -0.1254   0.607\n[5,]   4 -0.0692   0.623\nType 2: with drift no trend \n     lag    ADF p.value\n[1,]   0 -10.69    0.01\n[2,]   1  -7.69    0.01\n[3,]   2  -5.09    0.01\n[4,]   3  -4.09    0.01\n[5,]   4  -3.62    0.01\nType 3: with drift and trend \n     lag    ADF p.value\n[1,]   0 -11.37    0.01\n[2,]   1  -8.37    0.01\n[3,]   2  -5.70    0.01\n[4,]   3  -4.67    0.01\n[5,]   4  -4.23    0.01\n---- \nNote: in fact, p.value = 0.01 means p.value <= 0.01 \n```\n:::\n:::\n\n\nWe look at the Type II test since we have drift from zero mean. We reject all hypotheses so we believe our data is stationary. Let's model AR and MA terms now using automatic search.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_auto <- auto.arima(hurricane_ts, d = 0)\nsummary(model_auto)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSeries: hurricane_ts \nARIMA(1,0,1) with non-zero mean \n\nCoefficients:\n         ar1      ma1     mean\n      0.9507  -0.8578  91.2576\ns.e.  0.0449   0.0715   2.0728\n\nsigma^2 = 95.21:  log likelihood = -571.66\nAIC=1151.33   AICc=1151.59   BIC=1163.5\n\nTraining set error measures:\n                    ME     RMSE      MAE       MPE     MAPE     MASE\nTraining set 0.1588254 9.662622 7.674589 -0.949873 8.490576 0.724284\n                    ACF1\nTraining set -0.02716143\n```\n:::\n\n```{.r .cell-code}\nggAcf(model_auto$residuals)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggPacf(model_auto$residuals)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\nThrough lots of manual testing we settle on ARIMA(2, 0, 3):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel3 <- Arima(hurricane_ts, order = c(2, 0, 3))\nsummary(model3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSeries: hurricane_ts \nARIMA(2,0,3) with non-zero mean \n\nCoefficients:\n         ar1     ar2      ma1      ma2     ma3     mean\n      0.7921  0.1100  -0.7257  -0.1803  0.1578  91.4046\ns.e.  0.4161  0.3958   0.4094   0.3583  0.0791   1.8812\n\nsigma^2 = 94.76:  log likelihood = -569.79\nAIC=1153.58   AICc=1154.34   BIC=1174.88\n\nTraining set error measures:\n                     ME     RMSE      MAE       MPE    MAPE      MASE\nTraining set 0.07215997 9.544078 7.471114 -1.024043 8.28476 0.7050813\n                      ACF1\nTraining set -0.0003383851\n```\n:::\n\n```{.r .cell-code}\nggAcf(model3$residuals)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggPacf(model3$residuals)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n:::\n\n\n# Python\n:::\n\n# Forecasting\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}