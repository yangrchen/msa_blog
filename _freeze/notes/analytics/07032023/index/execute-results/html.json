{
  "hash": "2e6ac703b385c5edfa6dd5ef26014270",
  "result": {
    "markdown": "---\ntitle: More Complex ANOVA & Regression\ndate: 07/03/2023\ndate-modified: 07/23/2023\n---\n\n\n# n-Way ANOVA\n\n\n```{mermaid}\nflowchart LR\n    A[Continuous Target Variable] --> B[One-Way ANOVA]\n    A --> C[Two-Way ANOVA]\n    A --> D[n-Way ANOVA]\n```\n\n\n# Additional Linear Models Terminology\n\nA **model** is a mathematical relationship between explanatory variables and response variables.\n\nAn **effect** is the expected change in response that occurs with a change in value of an explanatory variable.\n\n-   The **main effect** is the effect of a single explanatory variable (e.g. $x_1, x_2, x_3$)\n\n# Exploring the (Ames) Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(AmesHousing)\n\names <- make_ordinal_ames()\nset.seed(123)\names <- ames |> mutate(id = row_number())\ntrain <- ames |> sample_frac(0.7)\ntest <- anti_join(ames, train, by = \"id\")\n\ndim(train)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2051   82\n```\n:::\n\n```{.r .cell-code}\ndim(test)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 879  82\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntrain %>%\n    group_by(Heating_QC, Central_Air) %>%\n    summarise(\n        mean = mean(Sale_Price),\n        sd = sd(Sale_Price),\n        max = max(Sale_Price),\n        min = min(Sale_Price)\n    )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'Heating_QC'. You can override using the\n`.groups` argument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 Ã— 6\n# Groups:   Heating_QC [5]\n   Heating_QC Central_Air    mean     sd    max    min\n   <ord>      <fct>         <dbl>  <dbl>  <int>  <int>\n 1 Poor       N            50050  52255.  87000  13100\n 2 Poor       Y           107000     NA  107000 107000\n 3 Fair       N            84748. 28267. 158000  37900\n 4 Fair       Y           145165. 38624. 230000  50000\n 5 Typical    N           103469. 34663. 209500  12789\n 6 Typical    Y           142003. 39657. 375000  60000\n 7 Good       N           110811. 38455. 214500  59000\n 8 Good       Y           160113. 54158. 415000  52000\n 9 Excellent  N           115062. 33271. 184900  64000\n10 Excellent  Y           216401. 88518. 745000  58500\n```\n:::\n:::\n\n\n-   `Central_Air` seems to have an effect on `Sale_Price`\n\nHowever, we always need to have statistical proof to back up any claims we make.\n\n# Two-Way ANOVA Using Ames\n\nWith Two-Way ANOVA we are trying to see if the two variables are actually having a significant effect on explaining/predicting sale price.\n\n$$\nY_{ijk} = \\mu + \\alpha_i + \\beta_j + \\varepsilon_{ijk}\n$$\n\n-   $\\mu$ is the base level\n-   $\\alpha_i$ is the heating quality\n-   $\\beta_j$ is central air\n-   $\\varepsilon$ is unexplained error\n\n\n::: {.cell}\n\n```{.r .cell-code}\names_aov2 <- aov(Sale_Price ~ Heating_QC + Central_Air, data = train)\nsummary(ames_aov2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              Df    Sum Sq   Mean Sq F value   Pr(>F)    \nHeating_QC     4 2.891e+12 7.228e+11  147.60  < 2e-16 ***\nCentral_Air    1 2.903e+11 2.903e+11   59.28 2.11e-14 ***\nResiduals   2045 1.002e+13 4.897e+09                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n-   The individual p-values are telling us whether or not the variable has some significant effect on the response\n-   If these two independent variables are completely independent then the p-values with just the one variable model would be the same\n\n## Post-Hoc Testing\n\nWe have statistical differences among the categories and we want to know where these differences exist.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntukey_ames2 <- TukeyHSD(ames_aov2)\nprint(tukey_ames2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  Tukey multiple comparisons of means\n    95% family-wise confidence level\n\nFit: aov(formula = Sale_Price ~ Heating_QC + Central_Air, data = train)\n\n$Heating_QC\n                       diff        lwr       upr     p adj\nFair-Poor          49176.42 -63650.448 162003.29 0.7571980\nTypical-Poor       67781.01 -42800.320 178362.35 0.4506761\nGood-Poor          87753.89 -23040.253 198548.03 0.1945181\nExcellent-Poor    146288.89  35818.859 256758.92 0.0028361\nTypical-Fair       18604.59  -6326.425  43535.61 0.2484556\nGood-Fair          38577.47  12718.894  64436.04 0.0004622\nExcellent-Fair     97112.47  72679.867 121545.07 0.0000000\nGood-Typical       19972.87   7050.230  32895.52 0.0002470\nExcellent-Typical  78507.88  68746.678  88269.07 0.0000000\nExcellent-Good     58535.00  46602.229  70467.78 0.0000000\n\n$Central_Air\n        diff      lwr      upr p adj\nY-N 43256.57 31508.27 55004.87     0\n```\n:::\n\n```{.r .cell-code}\nplot(tukey_ames2, las = 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/tukey-hsd-plots-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/tukey-hsd-plots-2.png){width=672}\n:::\n:::\n\n\n-   `diff` refers to the average difference in `Sale_Price` between the two categories\n\nKeep in mind that if you increase your sample size, **you should decrease your significance level**. P-values always go down with an increase in sample size.\n\n# Two-Way ANOVA with Interactions\n\nAn **interaction effect** is when the effect of one variable changes as levels of another variables changes (e.g. $x_1x_2, x_1x_2x_3$).\n\nInteraction does **not** mean that two variables are correlated with each other.\n\nIn an interaction term $x_1x_2$, changes in $x_2$ affect the relationship of $x_1$ to $y$ and vice versa.\n\n![Interaction Interpretation](images/interactions_interpretation.png)\n\n$$\nY_{ijk} = \\mu + \\alpha_i + \\beta_j + (\\alpha\\beta)_{ij} + \\varepsilon_{ijk}\n$$\n\n## R Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\names_aov_int <- aov(Sale_Price ~ Heating_QC * Central_Air, data = train)\nsummary(ames_aov_int)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                         Df    Sum Sq   Mean Sq F value   Pr(>F)    \nHeating_QC                4 2.891e+12 7.228e+11 147.897  < 2e-16 ***\nCentral_Air               1 2.903e+11 2.903e+11  59.403 1.99e-14 ***\nHeating_QC:Central_Air    4 3.972e+10 9.930e+09   2.032   0.0875 .  \nResiduals              2041 9.975e+12 4.887e+09                     \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n-   When you're looking at significance, make sure to look at the interaction's significance first.\n    -   If interaction exists, we no longer care if the individual variables are significant or not because it's the interaction that matters.\n\n## Model Hierarchy\n\nIdea of **model hierarchy**: If higher-order terms are significant, then we should keep all the main effect terms that are a part of the higher-order terms as well.\n\n## Slicing\n\nIf the interaction term was significant, the number of level pairs we would have to consider can be overwhelming. **Slicing** performs an F-test for means for one variable within the level of another variable.\n\nAn example is subsetting the data into `Central_Air`: Yes and `Central_Air`: No and then seeing the significance of `Heating_QC`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nCA_aov <- train %>%\n    group_by(Central_Air) %>%\n    nest() %>%\n    mutate(aov = map(data, ~ summary(aov(Sale_Price ~ Heating_QC, data = .x))))\nprint(CA_aov$aov)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n              Df    Sum Sq   Mean Sq F value Pr(>F)    \nHeating_QC     4 2.242e+12 5.606e+11   108.5 <2e-16 ***\nResiduals   1899 9.809e+12 5.165e+09                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n[[2]]\n             Df    Sum Sq   Mean Sq F value  Pr(>F)   \nHeating_QC    4 1.774e+10 4.435e+09   3.793 0.00582 **\nResiduals   142 1.660e+11 1.169e+09                   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n## Assumptions\n\nSame as One-Way ANOVA:\n\n-   Independence of observations\n-   Equality of variance\n    -   Levene Test only available for interactions\n-   Normality of categories\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}